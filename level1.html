<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Protocol 50 — Level 1</title>
  <style>
    :root { --bg:#0b0f14; --card:#111827; --muted:#94a3b8; --text:#e5e7eb; --ok:#22c55e; --bad:#ef4444; }
    body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:radial-gradient(1200px 600px at 70% 0%, #111827 0%, var(--bg) 55%); color:var(--text); }
    .wrap{ max-width:980px; margin:0 auto; padding:24px 16px 40px; }
    .top{ display:flex; gap:12px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap; }
    .title{ font-size:22px; font-weight:800; letter-spacing:.3px; }
    .sub{ color:var(--muted); margin-top:6px; line-height:1.4; }
    .pill{ background:rgba(148,163,184,.12); border:1px solid rgba(148,163,184,.22); padding:8px 10px; border-radius:999px; color:var(--muted); font-size:13px; }
    .panel{ margin-top:16px; background:rgba(17,24,39,.75); border:1px solid rgba(148,163,184,.18); border-radius:16px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.35); }
    .hud{ display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap; }
    .hud b{ font-size:14px; }
    .progress{ height:10px; background:rgba(148,163,184,.12); border-radius:999px; overflow:hidden; width:240px; border:1px solid rgba(148,163,184,.18); }
    .bar{ height:100%; width:0%; background:rgba(229,231,235,.8); transition:width .25s ease; }
    .grid{ margin-top:14px; display:grid; grid-template-columns:repeat(4,1fr); gap:10px; }
    @media (max-width:780px){ .grid{ grid-template-columns:repeat(3,1fr);} }
    @media (max-width:520px){ .grid{ grid-template-columns:repeat(2,1fr);} .progress{ width:100%; } }
    button.card{
      appearance:none; border:1px solid rgba(148,163,184,.18); background:rgba(2,6,23,.35);
      border-radius:14px; padding:10px; cursor:pointer; transition:transform .06s ease, border-color .2s ease, background .2s ease;
      display:flex; align-items:center; justify-content:center; min-height:120px;
    }
    button.card:hover{ transform:translateY(-1px); border-color:rgba(229,231,235,.35); background:rgba(2,6,23,.5);}
    button.card:disabled{ cursor:not-allowed; opacity:.7; transform:none; }
    .msg{ margin-top:14px; min-height:54px; display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;}
    .toast{ padding:10px 12px; border-radius:12px; border:1px solid rgba(148,163,184,.18); background:rgba(2,6,23,.35); color:var(--muted); }
    .toast.ok{ border-color:rgba(34,197,94,.45); color:#bbf7d0; }
    .toast.bad{ border-color:rgba(239,68,68,.45); color:#fecaca; }
    .letterbox{ font-size:18px; font-weight:900; letter-spacing:6px; }
    .controls{ display:flex; gap:10px; align-items:center; }
    .btn{
      border:1px solid rgba(148,163,184,.18); background:rgba(148,163,184,.10); color:var(--text);
      padding:10px 12px; border-radius:12px; cursor:pointer; font-weight:700;
    }
    .btn:hover{ border-color:rgba(229,231,235,.3); }
    .hidden{ display:none; }
    svg{ width:100%; max-width:120px; height:auto; }
    .sig{ color:rgba(148,163,184,.7); font-size:12px; margin-top:12px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <div class="title">PROTOCOL 50 — Level 1: Identificatie</div>
        <div class="sub">
          Kies per ronde het <b>menselijk onmogelijke</b> silhouet. Bij een correct antwoord krijg je de volgende letter.
        </div>
      </div>
      <div class="pill" id="roundPill">Ronde 1/5</div>
    </div>

    <div class="panel">
      <div class="hud">
        <div>
          <div><b>Doel:</b> ontgrendel de codenaam</div>
          <div class="sig">Tip: kijk naar gewrichten, zwaartepunt en anatomie.</div>
        </div>
        <div class="progress" aria-label="Voortgang"><div class="bar" id="bar"></div></div>
      </div>

      <div class="grid" id="grid" role="list提醒"></div>

      <div class="msg">
        <div class="toast" id="toast">Selecteer het onmogelijk silhouet.</div>
        <div class="controls">
          <div class="letterbox" id="letters">_ _ _ _ _</div>
          <button class="btn hidden" id="restart">Opnieuw</button>
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  // --- Simple stick-figure builder (SVG) ---
  const svg = (content) => `
    <svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <g fill="none" stroke="rgba(229,231,235,.92)" stroke-width="6" stroke-linecap="round" stroke-linejoin="round">
        ${content}
      </g>
    </svg>`;

  // "Normal" silhouettes (plausible poses)
  const NORMAL = [
    () => svg(`<circle cx="60" cy="20" r="10" />
              <path d="M60 30 L60 60" />
              <path d="M60 42 L40 52" /><path d="M60 42 L78 54" />
              <path d="M60 60 L46 86" /><path d="M60 60 L72 88" />`),

    () => svg(`<circle cx="60" cy="18" r="10" />
              <path d="M60 28 L58 62" />
              <path d="M58 40 L36 40" /><path d="M58 40 L82 34" />
              <path d="M58 62 L42 70" /><path d="M58 62 L70 92" />`),

    () => svg(`<circle cx="52" cy="20" r="10" />
              <path d="M52 30 L62 62" />
              <path d="M56 42 L34 58" /><path d="M58 44 L84 52" />
              <path d="M62 62 L44 92" /><path d="M62 62 L78 84" />`),

    () => svg(`<circle cx="60" cy="20" r="10" />
              <path d="M60 30 L60 58" />
              <path d="M60 40 L42 30" /><path d="M60 40 L78 30" />
              <path d="M60 58 L36 72" /><path d="M60 58 L82 74" />`),

    () => svg(`<circle cx="60" cy="20" r="10" />
              <path d="M60 30 L54 58" />
              <path d="M56 40 L34 30" /><path d="M56 40 L84 44" />
              <path d="M54 58 L46 92" /><path d="M54 58 L74 74" />`),

    () => svg(`<circle cx="66" cy="18" r="10" />
              <path d="M66 28 L58 58" />
              <path d="M62 40 L40 50" /><path d="M62 40 L84 58" />
              <path d="M58 58 L40 84" /><path d="M58 58 L70 92" />`),

    () => svg(`<circle cx="60" cy="20" r="10" />
              <path d="M60 30 L60 62" />
              <path d="M60 44 L34 46" /><path d="M60 44 L86 46" />
              <path d="M60 62 L52 92" /><path d="M60 62 L78 84" />`),

    () => svg(`<circle cx="56" cy="20" r="10" />
              <path d="M56 30 L64 60" />
              <path d="M60 44 L42 66" /><path d="M60 44 L86 40" />
              <path d="M64 60 L52 92" /><path d="M64 60 L84 80" />`),

    () => svg(`<circle cx="60" cy="18" r="10" />
              <path d="M60 28 L60 60" />
              <path d="M60 40 L48 60" /><path d="M60 40 L76 60" />
              <path d="M60 60 L44 80" /><path d="M60 60 L74 92" />`),

    () => svg(`<circle cx="60" cy="20" r="10" />
              <path d="M60 30 L60 54" />
              <path d="M60 38 L44 44" /><path d="M60 38 L78 54" />
              <path d="M60 54 L38 92" /><path d="M60 54 L84 86" />`),

    () => svg(`<circle cx="62" cy="20" r="10" />
              <path d="M62 30 L58 60" />
              <path d="M60 44 L40 34" /><path d="M60 44 L84 40" />
              <path d="M58 60 L48 92" /><path d="M58 60 L80 84" />`)
  ];

  // "Impossible" silhouettes (intentionally wrong anatomy)
  const IMPOSSIBLE = [
    // Head on ankle
    () => svg(`<circle cx="56" cy="90" r="10" />
              <path d="M60 30 L60 60" />
              <path d="M60 42 L40 52" /><path d="M60 42 L78 54" />
              <path d="M60 60 L46 86" /><path d="M60 60 L72 88" />`),

    // Legs attached to head
    () => svg(`<circle cx="60" cy="20" r="10" />
              <path d="M60 30 L60 52" />
              <path d="M60 40 L38 40" /><path d="M60 40 L82 34" />
              <path d="M60 20 L44 78" /><path d="M60 20 L74 84" />`),

    // Elbow bends backward (double joint kink)
    () => svg(`<circle cx="60" cy="20" r="10" />
              <path d="M60 30 L60 60" />
              <path d="M60 42 L44 36 L52 56" />
              <path d="M60 42 L82 34" />
              <path d="M60 60 L46 86" /><path d="M60 60 L72 88" />`),

    // Torso detached from hips
    () => svg(`<circle cx="60" cy="20" r="10" />
              <path d="M60 30 L60 44" />
              <path d="M60 42 L40 52" /><path d="M60 42 L78 54" />
              <path d="M60 64 L46 86" /><path d="M60 64 L72 88" />
              <path d="M60 46 L60 52" />`),

    // Arms attached to knees
    () => svg(`<circle cx="60" cy="20" r="10" />
              <path d="M60 30 L60 60" />
              <path d="M46 86 L30 68" /><path d="M72 88 L92 70" />
              <path d="M60 60 L46 86" /><path d="M60 60 L72 88" />`)
  ];

  const TARGET = ["J","O","H","A","N"];

  // For each round, pick 11 normals + 1 impossible, shuffle with seeded order.
  const rounds = TARGET.map((letter, idx) => {
    const impossible = IMPOSSIBLE[idx];
    const normals = [];
    for (let i=0;i<11;i++) normals.push(NORMAL[(idx*3 + i) % NORMAL.length]);
    const options = normals.map(fn => ({ kind:"normal", svg: fn() }));
    options.push({ kind:"impossible", svg: impossible() });
    return { letter, options };
  });

  // Deterministic shuffle (so you can test / send same layout)
  function mulberry32(a){ return function(){ let t=a+=0x6D2B79F5; t=Math.imul(t^t>>>15,t|1); t^=t+Math.imul(t^t>>>7,t|61); return ((t^t>>>14)>>>0)/4294967296; } }
  function shuffle(arr, seed){
    const rnd = mulberry32(seed);
    const a = arr.slice();
    for(let i=a.length-1;i>0;i--){
      const j = Math.floor(rnd()*(i+1));
      [a[i],a[j]]=[a[j],a[i]];
    }
    return a;
  }

  const grid = document.getElementById("grid");
  const toast = document.getElementById("toast");
  const lettersEl = document.getElementById("letters");
  const roundPill = document.getElementById("roundPill");
  const bar = document.getElementById("bar");
  const restartBtn = document.getElementById("restart");

  let round = 0;
  let solved = Array(5).fill("_");
  let locked = false;

  function render(){
    roundPill.textContent = `Ronde ${round+1}/5`;
    bar.style.width = `${(round/5)*100}%`;
    lettersEl.textContent = solved.join(" ");
    toast.className = "toast";
    toast.textContent = "Selecteer het onmogelijk silhouet.";
    grid.innerHTML = "";

    const opts = shuffle(rounds[round].options, 1000 + round*77);
    opts.forEach((opt, idx) => {
      const btn = document.createElement("button");
      btn.className = "card";
      btn.type = "button";
      btn.setAttribute("aria-label", `Silhouet ${idx+1}`);
      btn.innerHTML = opt.svg;
      btn.addEventListener("click", () => choose(opt.kind === "impossible"));
      grid.appendChild(btn);
    });

    restartBtn.classList.add("hidden");
  }

  function setButtonsDisabled(disabled){
    [...grid.querySelectorAll("button.card")].forEach(b => b.disabled = disabled);
  }

  function choose(correct){
    if (locked) return;
    if (!correct){
      toast.className = "toast bad";
      toast.textContent = "Niet mogelijk? Kijk naar anatomie en zwaartepunt. Probeer opnieuw.";
      return;
    }
    locked = true;
    setButtonsDisabled(true);

    const letter = rounds[round].letter;
    solved[round] = letter;
    lettersEl.textContent = solved.join(" ");

    toast.className = "toast ok";
    toast.textContent = `Correct. Letter ontgrendeld: ${letter}`;

    setTimeout(() => {
      round++;
      locked = false;
      if (round >= 5){
        bar.style.width = "100%";
        toast.className = "toast ok";
        toast.textContent = `Codenaam bevestigd: ${TARGET.join("")} ✅`;
        restartBtn.classList.remove("hidden");
        restartBtn.onclick = () => {
          round = 0;
          solved = Array(5).fill("_");
          locked = false;
          render();
        };
        // Keep grid disabled at end
        setButtonsDisabled(true);
        return;
      }
      render();
    }, 900);
  }

  render();
})();
</script>
</body>
</html>
